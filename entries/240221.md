# 17th February 2021

## TODOs from last meeting

1. Run `fcfdr` on our IMD data sets
2. Write on PID
3. Fix icFDR script

## What I've done this week

Not much to report in the way of results. 

I wrote scripts to run LDAK and `fcfdr` on the IMD data sets. Running LDAK was straightforward, but I have run into some problems with `fcfdr`:

1. memory requirements
2. sign of Spearman's rank-order correlation of principal and auxiliary p-values changes between whole data set and independent SNP-only subset

The first issue is fixed by simply increasing `cpus-per-task` and using `skylake-himem`, but I can't help but think I'm doing something incorrect in the way I call the `fcfdr` code. Some jobs fail on `skylake-himem` with `cpus-per-task=3`, but surely they don't need 48 GB+ of memory on a typical GWAS data set when run correctly? I don't know how `fcfdr` works yet, so perhaps they do. I used `profvis` with `cfdr` to profile time and will use it with `fcfdr` to profile memory usage.  

The second issue is more serious. Of the 8 IMD data sets (I've omitted T2D due to lack of rsIDs and the fact we have CAD as a control), the problem of the sign of Spearman's rank changing between the whole data set and the independent subset has come up in four of them. The `fcfdr::flexible_cfdr` function does not allow one to proceed if the sign of Spearman's differs between the two.

| Data set   |     All SNPs | Independent SNPs |
|------------|--------------|------------------|
| aster_pid  |  0.000750962 |    -0.0010075122 |
| cd_pid     |  0.006843397 |     0.0001317861 |
| t1d_pid    |  0.007959260 |     0.0027506435 |
| asthma_pid |  0.001900418 |    -0.0010343832 |
| ra_pid     | -0.000667339 |     0.0016879120 |
| uc_pid     |  0.003277888 |     0.0011328978 |
| cad_pid    |  0.001495890 |    -0.0014680780 |
| sle_pid    |  0.003735446 |     0.0017480544 |

I don't know why `fcfdr` stipulates this, but I'm looking into it. 

This issue caused me to wonder whether Spearman's rank is a reliable indicator of the sort of enrichment we care about in this context. I annotated my stratified Q-Q plots with Spearman's rank; the values differ from those in the table as the latter used SNPs present in both the GWAS data set and the 1000G data, whereas the Q-Q plots are not constrained to SNPs present in both the GWAS data set and the 1000G data. In addition to the deflection we seek in the stratified Q-Q plots, we can also look at enrichment for discoveries at certain FDRs as seen in the third plot.

![](/images/240221/pid_qqplots_sansMHC_1.png)
![](/images/240221/pid_qqplots_sansMHC_1.png)
![](/images/240221/pid_cfdr_1e-2.png)
